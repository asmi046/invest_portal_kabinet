В файле миграций database\migrations\2025_08_04_141648_create_declarations_table.php обяви поля таблицы руководствуясь списком:

- id заявителя (связь один к одному с моделью User)
- id организации (целое число)
- Тип документа (полиморфная связь с моделями типов документов)

Обязательно проставь ->comment
Так же на основе этой миграции заполни поле $fillable и $casts соответствующей модели

______


В файле миграций database\migrations\2025_08_04_142655_create_organizations_table.php обяви поля таблицы руководствуясь списком:

- Название организации (строка)
- Сокращенное название организации (строка)
- Телефон (строка, nullable)
- e-mail (строка, nullable)
- Документы доступные для обработки (полиморфная связь один ко многим с моделями типов документов)


Обязательно проставь ->comment
Так же на основе этой миграции заполни поле $fillable и $casts соответствующей модели

______

В сидере DocumentTypeSeeder.php сделай заполнение таблицы document_types на основе толей из миграции 2025_08_05_104635_create_document_types_table.php

В таблицу должны быть добавленны следующие элементы:

App\Models\AreaGet - Заявление на выделение земельного участка
App\Models\Project - Заявление на финансирование инвестиционного проекта
App\Models\TechnicalConnects - Заявление на технологическое присоединение к электрическим сетям
App\Models\Support - Заявление на государственную поддержку

Действуй на уровне базы данных а не моделей элоквент.

______

Реализуй следующую логику: в коллекции $user->documentTypes у каждого элемента есть поле model, если в коллекции есть элемент с полем model = 'App\Models\AreaGe' то возвращаем true иначе false

______

В файле миграций database\migrations\2025_08_05_173127_create_stages_table.php обяви поля таблицы руководствуясь списком:

- Имя (строка)
- Порядок (целое число по умолчанию 0)
- Описание (текст, nullable)
- Внешний ключ к таблице document_types


Обязательно проставь ->comment
Так же на основе этой миграции заполни поле $fillable и $casts соответствующей модели

_______


в файле app\Services\SmevEnvvelopeService.php перепиши метод setContractsData чтобы он реализовывал следующий алгоритм:

В переменную $files предается массив следующего вида:

[
           [
                'Document' => [
                    'uuid' => '28a2624e-c59e-4d82-89c9-4db9d451bb7f',
                    'docId' => '7b3ad8aa-026b-40df-83f2-0b7969083456',
                    'mimeType' => 'application/pdf',
                    'description' => 'Договор'
                ],

                'Signature' => [
                    [
                        'docId' => '7b3ad8aa-026b-40df-83f2-0b7969083456',
                        'uuid' => '70f5753a-1747-4542-a673-e892d1204836',
                        'mimeType' => 'application/x-pkcs7-signature',
                        'description' => 'Подпись'
                    ]
                ]
            ],

            [
                'Document' => [
                    'docId' => '7b3ad81a-026b-40df-83f2-0b7969083456',
                    'uuid' => \Ramsey\Uuid\Uuid::uuid1()->toString(),
                    'mimeType' => 'application/pdf',
                    'description' => 'Договор'
                ],

                'Signature' => [
                    [
                        'docId' => '7b3ad81a-026b-40df-83f2-0b7969083456',
                        'uuid' => \Ramsey\Uuid\Uuid::uuid1()->toString(),
                        'mimeType' => 'application/x-pkcs7-signature',
                        'description' => 'Подпись'
                    ]
                ]
            ],


        ]

Нужно в переданном документе найти секцию Contracts и заполнить ее элементами чтобы на выходе получилась вот такая структура:

<Contract>
			<Document docId="7b3ad8aa-026b-40df-83f2-0b7969083456" uuid="28a2624e-c59e-4d82-89c9-4db9d451bb7f" mimeType="application/pdf" description="Договор"/>
			<Signature docId="7b3ad8aa-026b-40df-83f2-0b7969083456" uuid="70f5753a-1747-4542-a673-e892d1204836" mimeType="application/x-pkcs7-signature" description="Подпись"/>

            <Document docId="..." uuid="..." mimeType="application/pdf" description="Договор"/>
			<Signature docId="..." uuid="..." mimeType="application/x-pkcs7-signature" description="Подпись"/>
</Contract>


______

В файле миграций  database\migrations\2025_08_07_112217_create_goskey_registries_table.php обяви поля таблицы руководствуясь списком:

- ID сообщения (uuid)
- Короткий идентификатор (строка, 70 символов)
- ID пользователя
- Тип документа
- Дата и время последней проверки
- Статус (строка, nullable)

Обязательно проставь ->comment
Так же на основе этой миграции заполни поле $fillable и $casts соответствующей модели
_____________

В текущем файле в методе signXmlFileViaNetwork считай данные из файла $xmlFilePath и при помощи встроенного http клиента отправь данные по адресу из конфига cryptcp_xml_address методом post с использованием multipart/form-data имя параметрк должно быть file. Так же должны быть переданы следующие параметры:
elementId со значением SIGNED_BY_CALLER
signatureElementName со значением ns:CallerInformationSystemSignature

В случае успеха результат должен быть записан в файл $outputFilePath
В случае если запрос будет с ошибкой то выброси исключение

_____________


Мне нужно написать метод в который будет передаваться simplxml и массив с параметрами
метод находит в документе узел <ns1:RefAttachmentHeaderList> и вставляет в него элементы:

<ns1:RefAttachmentHeader>
    <ns1:uuid>?</ns1:uuid>
    <ns1:Hash>?</ns1:Hash>
    <ns1:MimeType>?</ns1:MimeType>
</ns1:RefAttachmentHeader>

сгенерированные на основе массива

_____________

В текущем файле сервиса в методе analyze реализуй следующий функционал:
В него передается результат в виде xml
Метод производит проверку на наличие узла <soap:Fault> если этот узел присутствует то он находит внутри этого узла сдедующие параметры:
    -Узел faultstring его значение записываем в массив под одноименным ключем
    -Узел Code его значение записываем в массив под одноименным ключем
Иначе находит элемент ns2:MessageMetadata внутри которого находим элемент <ns2:Status> и его значение записываем под одноименным ключем в массив

Метод возвращает заполненный массив

_______

В комопненте resources\js\components\GoskeySignPanel.vue реализуй следующий функционал:

Сделай так чтобы в этот компонент передавались следующие пропсы:
    - модель документа (строка)
    - id документа (целое число)

Для кнопок с классами fign_fl, fign_ul сделай обработчики которые будут отправлять Get запрос на следующие адреса:
/goskey/sign_fl и /goskey/sign_ul соответственно. При отправке запросов в качестве параметров должны передаваться пропсы компонента
_____________

Сделай сервис назови его PrintServices в метод save которого будет переданы следующие параметры:
- класс модели
- id модели
- путь к файлу

Метод будет разрешать модель по переданной строке класса модели и вызывать выбирать нужный экзкмпляр модели по id и вызывать у этой модели метод принт предварительно проверив его наличие
_____________

в текущем файле  в метод getFilesFromFtp передается вот такой массив:

[
    "description" => "5-area-get.pdf"
    "docId" => "34e4e422-8991-11f0-bd32-00ffbbed2819"
    "mimeType" => "application/x-pkcs7-signature"
    "uuid" => "0bb23127-2708-4211-9d16-dff14c562a9e"
    "UserName" => "2fD7bncdWHOA8L7Lx2FPqV4xpE8ox5"
    "Password" => "1I345a5I5xZCIpknJqjgCuHGNkuEyS"
    "FileName" => "/34e4e5ee-8991-11f0-8586-00ffbbed2819_subsSign.pkcs7"
]

Нужно подключиться к FTP адрес и порт для подключения возьми из конфига config\goskey.php
Логин и пароль используй из элементов переданного массива с ключ UserName и Password
после подключения скачай файл с именем которое нужно взять из переданного массива элемент с клуючем FileName если файл скачен то метод возвращает true иначе false

__________________

В метод передан параметр  $originalMessageId скачиваемый файл нужно сохранить в локальном файловом хранилище по пути сформированном следеющим образом:
goskey_registry/{$originalMessageId}/{$fileInfo['description']}_subsSign.pkcs7

_____________

В компоненте resources\js\components\GoskeySignProcess.vue реализуй следующий функционал:
в вонмонент передается параметром message-id
Нужно отправлять каждые 3 секунды запрос на роут /goskey/get_sign_state (отправку осуществляем при помощи axios асинхронно)
В ответе будет приходить массив в котором будет  параметр status его нужно выводить в параграф шаблона
_____________

Изучи следующие файлы:

resources\views\components\document-forms\commissioning-permit.blade.php
resources\views\components\document-forms\construction-permit.blade.php
resources\views\components\document-forms\water-connection.blade.php
resources\views\components\document-forms\land-lease-application.blade.php

Особое внимание удели части которая расположенна между 2х комментариев

{{-- Начало формы --}}
{{-- Конец формы --}}

В этих фйлах реализованы CRUD формы для работы с таблицами описанными при помощи миграций:
database\migrations\2025_09_29_164226_create_commissioning_permits_table.php
database\migrations\2025_09_29_164047_create_construction_permits_table.php
database\migrations\2025_09_29_164203_create_water_connections_table.php
database\migrations\2025_09_29_163953_create_land_lease_applications_table.php

соответственно.

После того как изучишь данные формы и миграции сделай мне форму описывющую миграцию:
database\migrations\2025_09_29_164147_create_heat_connections_table.php

Параметр label для компонентов предварительно возьми из комментариев к полям модели, если они отсутутвуют придумай сам.
Задачу реши в чате, не трогай файлы.
_____________

Изучи следующие html файлы:

public\documents_template\CommissioningPermit.html
public\documents_template\WaterConnection.html
public\documents_template\LandLeaseApplication.html
public\documents_template\LandAuctionApplication.html
public\documents_template\ConstructionPermit.html
public\documents_template\GasConnection.html


На основе полученной информации сделай мне такой же html файл из прикрепленного к заданию документа. При выполнии задания опирайся на следующие инструкции:

    - Обрати внимание что в этих файлах встречаются параметры для замены вида: ${supplier_org} эти параметры нужно вставить опираясь на файлы миграции database\migrations\2025_09_29_164147_create_heat_connections_table.php внутрь фигурных скобок вставляй название полей миграции.

    - Учти что поля ${dey}, ${month}, ${year} отсутутсвуют в миграции но их нужно использовать.

    - Вставь вот эти стили и используй только их:

    <style>
            body { font-family: 'Times New Roman', Times, serif; font-size: 14px; }
            h1, h2, h3, h4, h5, h6 { text-align: center; margin: 10px 0; }
            h1 { font-size: 18px; }
            table { width: 100%; border-collapse: collapse; margin: 10px 0; }
            .table_empty td, .table_empty th{  width:100%; border: none; display: block; }
            .table_empty tbody {  width:100%; display: block; }
            .table_empty tbody tr {  width:100%; display: block; }
            .comment { font-size: 12px; font-style: italic;  text-align: center; }
            .p_comment { font-size: 12px; font-style: italic;  text-align: center; }
            .table_50{ width: 50%; }
            .table_left {display: block; margin-bottom: 20px; margin-left: auto;}
            td, th { border: 1px solid #000; padding: 5px; text-align: left; }
            .center { text-align: center; }
            .header { font-weight: bold; background-color: #f0f0f0; }
    </style>

    - В документе есть блок с подписями и местом для  печати его вставь следующим образом:

    <p>_________________________ / <u>${applicant_name}</u>   ${dey}" ${month} ${year} г.</p>

    <p style="text-align: left;" class="p_comment">(подпись)</p>

    <p>М.П.</p>

    - После блока подписей вставь воттакой параметр для замены: ${sign_stamped}
    - В параграфы с классом p_comment добавляй стиль style="border-top: 1px solid #000;"


_____________

Проанализируй файл

resources\views\components\document-forms\heat-connection.blade.php в нем описана форма, найди все компоненты с

:required="true" и сгенерируй для них правила и сообщения которые помести в request расположенный в файле

app\Http\Requests\HeatConnection\HeatConnectionSignRequest.php

При работе ориентируйся на описание полей из таблицы из миграции:

database\migrations\2025_09_29_164147_create_heat_connections_table.php

А так же на следующие правила:
В полях c упоминанием ОГРН / ОГРНИП / ИНН допускаются только цифры при этом они строковые а не целые
В полях c упоминанием площади должны быть вещественные значения отличные от нуля
В полях c упоминанием фраз Тепловая нагрузка, Расход теплоносителя проверяй на вещественное число
Правила делай в стиле массивов
Не изменяй других файлов только: app\Http\Requests\HeatConnection\HeatConnectionSignRequest.php



_____________

Изучи формы которые располагаются в файлах:
resources\views\components\document-forms\water-connection.blade.php
resources\views\components\document-forms\heat-connection.blade.php
resources\views\components\document-forms\commissioning-permit.blade.php
resources\views\components\document-forms\land-lease-application.blade.php

В файле resources\views\components\tc\edit-form.blade.php возьми содержимоне находящеся между 2 комментариев
{{-- начало описания формы --}}
{{-- конец описания формы --}}

Приобразуй содержимое в компоненты по примеру изученных форм.
Результат выведи в чат файлы не трогай.
